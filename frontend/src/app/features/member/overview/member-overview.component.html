<div class="mt-5" data-testid="member-overview">
  <h1 class="pt-3" data-testid="member-title">
    {{ "MODEL_NAME_PLURAL" | scopedTranslation }} ({{ members().length }})
  </h1>

  <div class="d-flex flex-row justify-content-between">
    <div class="w-25 d-flex flex-row align-items-start">
      <mat-form-field
        color="primary"
        appearance="outline"
        class="w-75 small-form-field"
        data-testid="search-field"
      >
        <mat-icon matPrefix>search</mat-icon>
        <input
          matInput
          [formControl]="searchControl"
          [placeholder]="'FILTER.SEARCH' | scopedTranslation"
          data-testid="search-input"
        />
      </mat-form-field>
    </div>

    <div data-testid="filters">
      <button
        type="button"
        mat-stroked-button
        class="rounded-0"
        [class.active]="isAllFilterActive()"
        (click)="activeFilters.clear(); applyCombinedFilter();"
        data-testid="all"
      >
        {{ 'FILTER.ALL' | scopedTranslation }}
      </button>

      @for (state of employmentStateValues; track state) {
        <button
          type="button"
          mat-stroked-button
          class="rounded-0"
          [class.active]="isFilterActive(state)"
          (click)="toggleFilter(state)"
          [attr.data-testid]="state"
        >
          {{ 'EMPLOYMENT_STATUS_VALUES.' + state | scopedTranslation }}
        </button>
      }
    </div>

    <button
      type="button"
      mat-stroked-button
      data-testid="add-member-button"
      (click)="handleAddMemberClick()"
    >
      <mat-icon>add</mat-icon>
        {{ 'MODEL_NAME' | scopedTranslation }}
        {{ 'FORM.ADD.ACTION' | scopedTranslation }}
    </button>
  </div>

  <div class="overflow-y-scroll mat-elevation-z8 table-max-height">
  <table
    mat-table
    [dataSource]="this.dataSource"
    class="table table-striped table-hover member-table m-0"
    matSort
    matSortActive="lastName"
    matSortDirection="asc"
    data-testid="member-table"
  >
    <ng-container matColumnDef="first_name">
      <th
        mat-header-cell
        *matHeaderCellDef
        mat-sort-header="firstName"
        data-testid="first-name-sort"
        class="col-range"  >
        {{ 'MEMBER.FIRST_NAME' | translate }}
      </th>
      <td
        mat-cell
        *matCellDef="let member"
        data-testid="member-first-name"
        class="col-range">
        {{ member.firstName }}
      </td>
    </ng-container>

    <ng-container matColumnDef="last_name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="lastName" data-testid="last-name-sort">
        {{ 'LAST_NAME' | scopedTranslation }}
      </th>
      <td mat-cell
        *matCellDef="let member"
        data-testid="member-last-name">
        {{ member.lastName }}
      </td>
    </ng-container>

    <ng-container matColumnDef="birth_date">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="birthDate" data-testid="birth-date-sort">
        {{ 'BIRTH_DATE' | scopedTranslation }}
      </th>
      <td mat-cell *matCellDef="let member" data-testid="member-birthDate">
        {{ member.birthDate | date: GLOBAL_DATE_FORMAT }}
      </td>
    </ng-container>

    <ng-container matColumnDef="organisation_unit">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="organisationUnit.name" data-testid="organisation-unit-name-sort">
        {{ 'ORGANISATION_UNIT' | scopedTranslation }}
      </th>
      <td mat-cell *matCellDef="let member" data-testid="member-organisation">
        {{ member.organisationUnit.name }}
      </td>
    </ng-container>

    <ng-container matColumnDef="employment_state">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="employmentState" data-testid="employment-state-sort">
        {{ 'EMPLOYMENT_STATE' | scopedTranslation }}
      </th>
      <td mat-cell *matCellDef="let member" data-testid="member-status">
        {{ "MEMBER.EMPLOYMENT_STATUS_VALUES." + member.employmentState | translate }}
      </td>
    </ng-container>

    <tr class="h-25" mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns;"
      [routerLink]="['/member', row.id]"
      class="clickable-row"
      data-testid="member-row"
    ></tr>

    <tr *matNoDataRow data-testid="no-results-row">
      <td colspan="4">
        {{ 'TABLE.NO_SEARCH_RESULT' | scopedTranslation : {model: 'MODEL_NAME' | scopedTranslation ,searchValue: searchControl.value} }}
      </td>
    </tr>
  </table>
  </div>
</div>
