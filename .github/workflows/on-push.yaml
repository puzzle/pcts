---
name: "On push"

on:
  push:

jobs:
  format:
    uses: ./.github/workflows/reusable__format.yaml
    with:
      COMMIT_HASH: ${{ github.sha }}

  tests:
    uses: ./.github/workflows/reusable__tests.yaml
    with:
      COMMIT_HASH: ${{ github.sha }}

  e2e-tests:
    needs:
      - format
      - tests
    uses: ./.github/workflows/reusable__e2e-testing.yaml
    with:
      COMMIT_HASH: ${{ github.sha }}

  deploy-to-ghrc:
    if: github.ref == 'refs/heads/feature/5-upload-docker-images-to-GHCR'
    needs: [e2e-tests, format, tests]
    strategy:
      matrix:
        dockerfilePath: ["backend/Dockerfile", "frontend/Dockerfile"]
    uses: ./.github/workflows/reusable__upload-to-ghcr.yaml
    with:
      dockerfilePath: ${{ matrix.dockerfilePath }}
    secrets: inherit
